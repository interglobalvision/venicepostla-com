{"version":3,"sources":["main.js"],"names":["Site","animationSpeed","mobileThreshold","init","_this","this","$","window","resize","onResize","document","ready","HomeAnimation","WP","audio","Audio","beforeAjax","clearAnimation","afterAjax","length","getAndSetMaxImageSize","fixWidows","each","string","html","replace","shuffleArray","array","i","j","Math","floor","random","temp","active","paused","nextImage","numberOfFirstLoadImages","requestDelay","minImages","preloadedImages","$animation","images","animationImages","headerLogoTop","headerNavLeft","requestFirstImages","bindPauses","off","on","mouseover","mouseout","touchstart","touchend","addImage","loadNextImage","imageIndex","srcset","generateSrcset","append","bind","addClass","setMaxImageSize","first","animate","setTimeout","animationInterval","setInterval","$active","index","$next","eq","removeClass","clearInterval","paddingTop","parseInt","css","paddingSide","offset","left","logoHeight","height","navWidth","width","imageMaxHeight","imageMaxWidth","max-height","max-width","image","property","hasOwnProperty","substr","isLooped","isAutoplay","isPlaying","audio_loop_boolean","audio_autoplay_boolean","createPlayer","player","Howl","src","audio_file","autoplay","loop","volume","onload","isInitialized","onplay","onpause","Ajaxy","ajaxyLinks","onpopstate","ajaxLoad","location","origin","pathname","click","event","preventDefault","url","currentTarget","href","scrollTop","ajax","beforeSend","ajaxBefore","dataType","error","jqXHR","textStatus","ajaxErrorHandler","success","data","ajaxSuccess","alert","console","log","responseHtml","createElement","innerHTML","bodyClasses","attr","title","text","$content","contentClasses","$header","history","pushState","removeAttr"],"mappings":"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","file":"main.min.js","sourcesContent":["/* jshint browser: true, devel: true, indent: 2, curly: true, eqeqeq: true, futurehostile: true, latedef: true, undef: true, unused: true */\n/* global $, jQuery, document, Site, Ajaxy, WP, Howl */\n\nSite = {\n  animationSpeed: 50,\n  mobileThreshold: 601,\n  init: function() {\n    var _this = this;\n\n    $(window).resize(function(){\n      _this.onResize();\n    });\n\n    $(document).ready(function () {\n\n    });\n\n    _this.HomeAnimation.init();\n\n    if (WP.audio !== null) {\n      _this.Audio.init();\n    }\n  },\n\n  beforeAjax: function() {\n    this.HomeAnimation.clearAnimation();\n  },\n\n  afterAjax: function() {\n    this.HomeAnimation.init();\n  },\n\n  onResize: function() {\n    var _this = this;\n\n    if ($('.animation-image').length) {\n      _this.HomeAnimation.getAndSetMaxImageSize();\n    }\n  },\n\n  fixWidows: function() {\n    // utility class mainly for use on headines to avoid widows [single words on a new line]\n    $('.js-fix-widows').each(function(){\n      var string = $(this).html();\n      string = string.replace(/ ([^ ]*)$/,'&nbsp;$1');\n      $(this).html(string);\n    });\n  },\n\n  shuffleArray: function(array) {\n    for (var i = array.length - 1; i > 0; i--) {\n      var j = Math.floor(Math.random() * (i + 1));\n      var temp = array[i];\n\n      array[i] = array[j];\n      array[j] = temp;\n    }\n  }\n};\n\nSite.HomeAnimation = {\n  active: false,\n  paused: false,\n  nextImage: 0,\n  numberOfFirstLoadImages: 6,\n  requestDelay: 250,\n  animationSpeed: 250,\n  minImages: 3,\n  preloadedImages: 0,\n  init: function() {\n    var _this = this;\n\n    _this.$animation = $('#home-animation');\n    _this.images = WP.animationImages;\n    _this.headerLogoTop = $('#header-item-venice');\n    _this.headerNavLeft = $('#header-item-left');\n\n    if (_this.images.length > 0) {\n      // shuffle randomize array of images from enqueue\n      Site.shuffleArray(_this.images);\n\n      // trigger request of first images\n      _this.requestFirstImages();\n\n      // get & set image max height & width\n      _this.getAndSetMaxImageSize();\n\n    }\n  },\n\n  bindPauses: function() {\n    var _this = this;\n\n    $('.animation-image').off().on({\n      'mouseover': function() {\n        _this.paused = true;\n      },\n      'mouseout': function() {\n        _this.paused = false;\n      },\n      'touchstart': function() {\n        _this.paused = true;\n      },\n      'touchend': function() {\n        _this.paused = false;\n      }\n    });\n  },\n\n  requestFirstImages: function() {\n    var _this = this;\n\n    // get the first x images in the array\n    for (var i = 0; i < _this.numberOfFirstLoadImages; i++) {\n      _this.addImage(i);\n    }\n  },\n\n  loadNextImage: function() {\n    var _this = this;\n\n    // if there is an image at the nextImage index\n    if (_this.images[_this.nextImage]) {\n      _this.addImage(_this.nextImage);\n    }\n  },\n\n  addImage: function(imageIndex) {\n    var _this = this;\n    var srcset = _this.generateSrcset(_this.images[imageIndex]);\n\n    // append img tag for image\n    _this.$animation.append('<img src=\"' + _this.images[imageIndex]['1000'] + '\" srcset=\"' + srcset + '\" id=\"animation-image-' + imageIndex + '\" class=\"animation-image\" />');\n\n    // bind to load event of inserted image\n    $('#animation-image-' + imageIndex).bind('load', function() {\n      // on loaded set loaded class\n      $(this).addClass('animation-image-loaded');\n\n      _this.setMaxImageSize();\n\n      _this.bindPauses();\n\n      _this.preloadedImages++;\n\n      // if animation isn't active trigger animation and more images and the min are loaded\n      if (!_this.active && _this.preloadedImages >= _this.minImages) {\n\n        // set max image size with cached sizes\n        $('.animation-image-loaded').first().addClass('active');\n\n        _this.bindPauses();\n\n        _this.animate();\n      }\n\n      // set timeout to load next image after x delay\n      window.setTimeout(function() {\n        _this.loadNextImage();\n      }, _this.requestDelay);\n    });\n\n    // set next image index to next image\n    _this.nextImage++;\n  },\n\n  animate: function() {\n    var _this = this;\n\n    // set active state true\n    _this.active = true;\n\n    _this.animationInterval = setInterval(function() {\n      if (!_this.paused) {\n        var $active = $('.animation-image-loaded.active');\n        var index = $active.index('.animation-image-loaded')\n        var $next = $('.animation-image-loaded').eq(index + 1);\n\n        // hid current image\n        $active.removeClass('active');\n\n        if ($next.length) {\n          // if next show it\n          $next.addClass('active');\n        } else {\n          // otherwise restart loop\n          $('.animation-image-loaded').first().addClass('active');\n        }\n      }\n    }, _this.animationSpeed);\n\n  },\n\n  clearAnimation: function() {\n    var _this = this;\n\n    _this.active = false;\n    _this.paused = false;\n    _this.nextImage =  0;\n\n    if (_this.animationInterval) {\n      window.clearInterval(_this.animationInterval);\n    }\n  },\n\n  getAndSetMaxImageSize: function() {\n    var _this = this;\n\n    // get max height and width for images based on header elems\n\n    // get logo padding-top and convert to integer\n    var paddingTop = parseInt(_this.headerLogoTop.css('padding-top'));\n\n    // get side padding value from left nav offset\n    var paddingSide = _this.headerNavLeft.offset().left;\n\n    // margin twice plus dimension. x2 for both items\n    var logoHeight = (_this.headerLogoTop.height() + (paddingTop * 2)) * 2;\n    var navWidth = (_this.headerNavLeft.width() + (paddingSide * 2)) * 2;\n\n    _this.imageMaxHeight = $(window).height() - logoHeight;\n    _this.imageMaxWidth = $(window).width() - navWidth;\n\n    _this.setMaxImageSize();\n  },\n\n  setMaxImageSize: function() {\n    var _this = this;\n\n    // set max height and width for images\n    $('.animation-image').css({\n      'max-height': _this.imageMaxHeight + 'px',\n      'max-width': _this.imageMaxWidth + 'px',\n    });\n  },\n\n  generateSrcset: function(image) {\n    var srcset = '';\n\n    // for each key value pair generate srcset string\n    for (var property in image) {\n      if (image.hasOwnProperty(property)) {\n        srcset += image[property] + ' ' + property + 'w, ';\n      }\n    }\n\n    // trim last 2 characters which will be a comma and a space\n    srcset = srcset.substr(0, srcset.length-2);\n\n    return srcset;\n  }\n};\n\nSite.Audio = {\n  isLooped: false,\n  isAutoplay: false,\n\n  isPlaying: false,\n\n  init: function() {\n    var _this = this;\n\n    if (WP.audio.audio_loop_boolean === 'on') {\n      _this.isLooped = true;\n    }\n\n    if (WP.audio.audio_autoplay_boolean === 'on') {\n      _this.isAutoplay = true;\n    }\n\n    _this.createPlayer();\n  },\n\n  createPlayer: function() {\n    var _this = this;\n\n    _this.player = new Howl({\n      src: [WP.audio.audio_file],\n      autoplay: _this.isAutoplay,\n      loop: _this.isLooped,\n      volume: 0.9,\n      onload: function() {\n        _this.isInitialized = true;\n      },\n      onplay: function() {\n        _this.isPlaying = true;\n      },\n      onpause: function() {\n        _this.isPlaying = false;\n      }\n    });\n  }\n};\n\nSite.init();\n\nAjaxy = {\n  ajaxyLinks: 'a',\n\n  init: function() {\n    var _this = this;\n\n    _this.bind();\n\n    // For back button\n    window.onpopstate = function() {\n      _this.ajaxLoad(document.location.origin + document.location.pathname);\n    };\n  },\n\n  bind: function() {\n    var _this = this;\n\n    // Find all ajaxy links and bind ajax event\n    $(_this.ajaxyLinks).click(function(event) {\n      event.preventDefault();\n\n      var url = event.currentTarget.href;\n\n      $('#main-content').addClass('main-content-hidden');\n      $('html, body').animate({scrollTop: 0,}, Site.animationSpeed);\n\n      _this.ajaxLoad(url);\n    });\n\n  },\n\n  ajaxLoad: function(url) {\n    var _this = this;\n\n    $.ajax(url, {\n      beforeSend: function() {\n        _this.ajaxBefore();\n      },\n\n      dataType: 'html',\n      error: function(jqXHR, textStatus) {\n        _this.ajaxErrorHandler(jqXHR, textStatus);\n      },\n\n      success: function(data) {\n        _this.ajaxSuccess(data, url);\n        $('#main-content').removeClass('main-content-hidden');\n      },\n    });\n  },\n\n  ajaxErrorHandler: function(jqXHR, textStatus) {\n    alert(textStatus);\n    console.log(jqXHR);\n  },\n\n  ajaxBefore: function() {\n    $('#main-content').html('');\n    Site.beforeAjax();\n  },\n\n  ajaxSuccess: function(data, url) {\n    var _this = this;\n\n    // Convert data into proper html to be able to fully parse thru jQuery\n    _this.responseHtml = document.createElement('html');\n    _this.responseHtml.innerHTML = data;\n\n    // Unbind events\n    $(window).off('resize');\n    $(window).off('scroll');\n    $(document).off('keydown');\n\n    // Get changes: body classes, page title, main content, main content classes, header\n    var bodyClasses = $('body', _this.responseHtml).attr('class');\n    var title = $('title', _this.responseHtml).text();\n    var $content = $('#main-content', _this.responseHtml);\n    var contentClasses = $('#main-content', _this.responseHtml).attr('class');\n    var $header = $('#header', _this.responseHtml);\n\n    // Push new history state and update title\n    history.pushState(null, title, url);\n    document.title = title;\n\n    // Update with new content and classes\n    $('body').removeAttr('class').addClass(bodyClasses);\n    $('#main-content').html($content.html()).removeAttr('class').addClass(contentClasses);\n    $('#header').html($header.html());\n\n    // After ajax site re-init\n    Site.afterAjax();\n\n    // Rebind after ajax for new <a> tags\n    _this.bind();\n  },\n};\n\nAjaxy.init();"]}